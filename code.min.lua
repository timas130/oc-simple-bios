local a=component.invoke;local function b(c,d,...)local e=table.pack(pcall(a,c,d,...))if not e[1]then return nil,e[2]else return table.unpack(e,2,e.n)end end;local f=math.floor;local g,i=component.list("gpu",true)(),component.list("screen",true)()function sleep(j)local k=computer.uptime()+(j or 0)repeat computer.pullSignal(k-computer.uptime())until computer.uptime()>=k end;local l=component.list("eeprom",true)()computer.getBootAddress=function()return b(l,"getData")end;computer.setBootAddress=function(c)return b(l,"setData",c)end;function boot(m)local n=b(m,"open","init.lua","r")local o=""repeat local p=b(m,"read",n,math.huge)o=o..(p or"")until not p;b(m,"close",n)local q,r=pcall(load(o,"=init","bt",_G))b(g,"fill",1,1,w,h," ")b(g,"setBackground",0x000000)if not q then b(g,"setForeground",0xFF0000)b(g,"set",1,1,r)else b(g,"setForeground",0x00FF00)b(g,"set",1,1,"Program completed.")end end;local s=0x36C436;local t=0;b(g,"bind",i)local w,h=b(g,"maxResolution")b(g,"setResolution",w,h)b(g,"setForeground",s)b(g,"setBackground",t)b(g,"fill",1,1,w,h," ")local u="Simple BIOS 1.0"b(g,"set",f(w/2-#u/2),3,u)local v;local x=nil;local y={}local z="RENAME"function drawDrives()b(g,"setBackground",t)b(g,"setForeground",s)b(g,"fill",1,4,w,h-4," ")v=component.list("filesystem",true)for A in v do local B=string.len(b(A,"getLabel"))if not x or B>x then x=B end end;local C=6;for A in v do if not b(A,"exists","init.lua")then goto D end;b(g,"setBackground",s)b(g,"setForeground",t)local B=b(A,"getLabel")b(g,"set",4,C," "..B.." ")b(g,"setBackground",t)b(g,"setForeground",s)if A==computer.getBootAddress()then b(g,"set",x+8,C,"Default device")elseif not b(A,"exists","init.lua")then b(g,"set",x+8,C,"Not loadable")elseif b(A,"isReadOnly")then b(g,"set",x+8,C,"Read-only, loadable")else b(g,"set",x+8,C,"Loadable")end;b(g,"set",w-string.len(z)-1,C,z)y[C]=A;C=C+2::D::end end;local E=false;local F=""local G=""local H="New name, empty to reset: "function renameDrive(c)b(g,"setBackground",t)b(g,"setForeground",s)b(g,"fill",4,h-2,w-4,1," ")b(g,"set",4,h-2,H)F=c;E=true;G=""end;drawDrives()local k=computer.uptime()+5;while true do local I,J,K,L=computer.pullSignal(k-computer.uptime())if I=="key_down"and E then if L==0x0E then G=G:sub(1,-2)b(g,"fill",4,h-2,w-4,1," ")b(g,"set",4,h-2,H..G)elseif L==0x1C then E=false;if string.len(G)==0 then b(g,"fill",4,h-2,w-4,1," ")drawDrives()goto M end;b(F,"setLabel",G)b(g,"fill",4,h-2,w-4,1," ")drawDrives()elseif string.len(G)<16 and K~=0 then G=G..string.char(K)b(g,"fill",4,h-2,w-4,1," ")b(g,"set",4,h-2,H..G)end elseif I=="touch"then k=math.huge;local m=y[L]if not m then goto M end;if K>=w-string.len(z)-1 then renameDrive(m)goto M end;if b(m,"exists","init.lua")then b(g,"fill",4,h-2,w-4,1," ")b(g,"set",4,h-2,"Loading from this device...")boot(m)else b(g,"fill",4,h-2,w-4,1," ")b(g,"set",4,h-2,"This device is not loadable, init.lua missing!")end end;if computer.uptime()>=k then boot(computer.getBootAddress())end::M::end
