local a=component.invoke;local function b(c,d,...)local e=table.pack(pcall(a,c,d,...))if not e[1]then return nil,e[2]else return table.unpack(e,2,e.n)end end;function waitForCtrl(f)local deadline=computer.uptime()+f;repeat local g,i,i,j=computer.pullSignal(deadline-computer.uptime())if g=="key_down"and(j==0x1D or j==0x9D)then return true end until computer.uptime()>=deadline;return false end;local k=math.floor;local l,m=component.list("gpu",true)(),component.list("screen",true)()local n=component.list("eeprom",true)()computer.getBootAddress=function()return b(n,"getData")end;computer.setBootAddress=function(c)return b(n,"setData",c)end;function boot(o)local p=b(o,"open","init.lua","r")local q=""repeat local r=b(o,"read",p,math.huge)q=q..(r or"")until not r;b(o,"close",p)local s,t=pcall(load(q,"=init","bt",_G))b(l,"fill",1,1,w,h," ")b(l,"setBackground",0x000000)if not s then b(l,"setForeground",0xFF0000)b(l,"set",1,1,t)while true do computer.pullSignal()end else b(l,"setForeground",0x00FF00)b(l,"set",1,1,"Program completed.")end end;local u=0x36C436;local v=0;b(l,"bind",m)local w,h=b(l,"maxResolution")b(l,"setResolution",w,h)b(l,"setForeground",u)b(l,"setBackground",v)b(l,"fill",1,1,w,h," ")local x="Press Ctrl to enter boot menu"b(l,"set",k(w/2-unicode.len(x)/2),4,x)if not waitForCtrl(1)then boot(computer.getBootAddress())else b(l,"fill",1,1,w,h," ")end;function setStatus(y)b(l,"fill",4,h-2,w-4,1," ")b(l,"set",4,h-2,y)end;local z="Simple BIOS 1.1"b(l,"set",k(w/2-unicode.len(z)/2),3,z)local A;local B=nil;local C={}local D="RENAME"function drawDrives()b(l,"setBackground",v)b(l,"setForeground",u)b(l,"fill",1,4,w,h-4," ")A=component.list("filesystem",true)for E in A do local F=unicode.len(b(E,"getLabel"))if not B or F>B then B=F end end;local G=6;for E in A do if not b(E,"exists","init.lua")then goto H end;b(l,"setBackground",u)b(l,"setForeground",v)local F=b(E,"getLabel")b(l,"set",4,G," "..F.." ")b(l,"setBackground",v)b(l,"setForeground",u)if E==computer.getBootAddress()then b(l,"set",B+8,G,"Default device")elseif not b(E,"exists","init.lua")then b(l,"set",B+8,G,"Not loadable")elseif b(E,"isReadOnly")then b(l,"set",B+8,G,"Read-only, loadable")else b(l,"set",B+8,G,"Loadable")end;b(l,"set",w-unicode.len(D)-1,G,D)C[G]=E;G=G+2::H::end;G=G+1;if component.list("internet",true)()then b(l,"set",4,G," Download recovery tools ")C[G]="internet"end end;local I=false;local J=""local K=""local L="New name, empty to reset: "function renameDrive(c)b(l,"setBackground",v)b(l,"setForeground",u)setStatus(L)J=c;I=true;K=""end;drawDrives()while true do local g,M,N,O=computer.pullSignal()if g=="key_down"and I then if O==0x0E then K=unicode.sub(K,1,-2)setStatus(L..K)elseif O==0x1C then I=false;if string.len(K)==0 then b(l,"fill",4,h-2,w-4,1," ")drawDrives()goto P end;b(J,"setLabel",K)b(l,"fill",4,h-2,w-4,1," ")drawDrives()elseif string.len(K)<16 and N~=0 then K=K..unicode.char(N)setStatus(L..K)end elseif g=="touch"then deadline=math.huge;local o=C[O]if not o then goto P end;if o=="internet"then setStatus("Downloading recovery module...")local e=b(component.list("internet",true)(),"request","http://localhost/recovery.lua").read()load(e,"=recovery.lua","bt",_G)()waitForCtrl(5)drawDrives()goto P end;if N>=w-string.len(D)-1 then renameDrive(o)goto P end;if b(o,"exists","init.lua")then setStatus("Loading from this device...")boot(o)else setStatus("This device is not loadable, init.lua missing!")end end::P::end
